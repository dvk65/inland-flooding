var I=6,q="AJSAJS",y="AFAFAF",A=65,d=73,k=79,z=86,C=90,E={forward:J,inverse:U,toPoint:B};function J(t,r){return r=r||5,Q(H({lat:t[1],lon:t[0]}),r)}function U(t){var r=R(D(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat,r.lon,r.lat]:[r.left,r.bottom,r.right,r.top]}function B(t){var r=R(D(t.toUpperCase()));return r.lat&&r.lon?[r.lon,r.lat]:[(r.left+r.right)/2,(r.top+r.bottom)/2]}function S(t){return t*(Math.PI/180)}function V(t){return 180*(t/Math.PI)}function H(t){var r=t.lat,n=t.lon,u=6378137,o=.00669438,c=.9996,i,a,f,s,v,e,l,M=S(r),h=S(n),m,g;g=Math.floor((n+180)/6)+1,n===180&&(g=60),r>=56&&r<64&&n>=3&&n<12&&(g=32),r>=72&&r<84&&(n>=0&&n<9?g=31:n>=9&&n<21?g=33:n>=21&&n<33?g=35:n>=33&&n<42&&(g=37)),i=(g-1)*6-180+3,m=S(i),a=o/(1-o),f=u/Math.sqrt(1-o*Math.sin(M)*Math.sin(M)),s=Math.tan(M)*Math.tan(M),v=a*Math.cos(M)*Math.cos(M),e=Math.cos(M)*(h-m),l=u*((1-o/4-3*o*o/64-5*o*o*o/256)*M-(3*o/8+3*o*o/32+45*o*o*o/1024)*Math.sin(2*M)+(15*o*o/256+45*o*o*o/1024)*Math.sin(4*M)-35*o*o*o/3072*Math.sin(6*M));var w=c*f*(e+(1-s+v)*e*e*e/6+(5-18*s+s*s+72*v-58*a)*e*e*e*e*e/120)+5e5,b=c*(l+f*Math.tan(M)*(e*e/2+(5-s+9*v+4*v*v)*e*e*e*e/24+(61-58*s+s*s+600*v-330*a)*e*e*e*e*e*e/720));return r<0&&(b+=1e7),{northing:Math.round(b),easting:Math.round(w),zoneNumber:g,zoneLetter:K(r)}}function R(t){var r=t.northing,n=t.easting,u=t.zoneLetter,o=t.zoneNumber;if(o<0||o>60)return null;var c=.9996,i=6378137,a=.00669438,f,s=(1-Math.sqrt(1-a))/(1+Math.sqrt(1-a)),v,e,l,M,h,m,g,w,b,p=n-5e5,G=r;u<"N"&&(G-=1e7),g=(o-1)*6-180+3,f=a/(1-a),m=G/c,w=m/(i*(1-a/4-3*a*a/64-5*a*a*a/256)),b=w+(3*s/2-27*s*s*s/32)*Math.sin(2*w)+(21*s*s/16-55*s*s*s*s/32)*Math.sin(4*w)+151*s*s*s/96*Math.sin(6*w),v=i/Math.sqrt(1-a*Math.sin(b)*Math.sin(b)),e=Math.tan(b)*Math.tan(b),l=f*Math.cos(b)*Math.cos(b),M=i*(1-a)/Math.pow(1-a*Math.sin(b)*Math.sin(b),1.5),h=p/(v*c);var P=b-v*Math.tan(b)/M*(h*h/2-(5+3*e+10*l-4*l*l-9*f)*h*h*h*h/24+(61+90*e+298*l+45*e*e-252*f-3*l*l)*h*h*h*h*h*h/720);P=V(P);var N=(h-(1+2*e+l)*h*h*h/6+(5-2*l+28*e-3*l*l+8*f+24*e*e)*h*h*h*h*h/120)/Math.cos(b);N=g+V(N);var L;if(t.accuracy){var F=R({northing:t.northing+t.accuracy,easting:t.easting+t.accuracy,zoneLetter:t.zoneLetter,zoneNumber:t.zoneNumber});L={top:F.lat,right:F.lon,bottom:P,left:N}}else L={lat:P,lon:N};return L}function K(t){var r="Z";return 84>=t&&t>=72?r="X":72>t&&t>=64?r="W":64>t&&t>=56?r="V":56>t&&t>=48?r="U":48>t&&t>=40?r="T":40>t&&t>=32?r="S":32>t&&t>=24?r="R":24>t&&t>=16?r="Q":16>t&&t>=8?r="P":8>t&&t>=0?r="N":0>t&&t>=-8?r="M":-8>t&&t>=-16?r="L":-16>t&&t>=-24?r="K":-24>t&&t>=-32?r="J":-32>t&&t>=-40?r="H":-40>t&&t>=-48?r="G":-48>t&&t>=-56?r="F":-56>t&&t>=-64?r="E":-64>t&&t>=-72?r="D":-72>t&&t>=-80&&(r="C"),r}function Q(t,r){var n="00000"+t.easting,u="00000"+t.northing;return t.zoneNumber+t.zoneLetter+T(t.easting,t.northing,t.zoneNumber)+n.substr(n.length-5,r)+u.substr(u.length-5,r)}function T(t,r,n){var u=Z(n),o=Math.floor(t/1e5),c=Math.floor(r/1e5)%20;return W(o,c,u)}function Z(t){var r=t%I;return r===0&&(r=I),r}function W(t,r,n){var u=n-1,o=q.charCodeAt(u),c=y.charCodeAt(u),i=o+t-1,a=c+r,f=!1;i>C&&(i=i-C+A-1,f=!0),(i===d||o<d&&i>d||(i>d||o<d)&&f)&&i++,(i===k||o<k&&i>k||(i>k||o<k)&&f)&&(i++,i===d&&i++),i>C&&(i=i-C+A-1),a>z?(a=a-z+A-1,f=!0):f=!1,(a===d||c<d&&a>d||(a>d||c<d)&&f)&&a++,(a===k||c<k&&a>k||(a>k||c<k)&&f)&&(a++,a===d&&a++),a>z&&(a=a-z+A-1);var s=String.fromCharCode(i)+String.fromCharCode(a);return s}function D(t){if(t&&t.length===0)throw"MGRSPoint coverting from nothing";for(var r=t.length,n=null,u="",o,c=0;!/[A-Z]/.test(o=t.charAt(c));){if(c>=2)throw"MGRSPoint bad conversion from: "+t;u+=o,c++}var i=parseInt(u,10);if(c===0||c+3>r)throw"MGRSPoint bad conversion from: "+t;var a=t.charAt(c++);if(a<="A"||a==="B"||a==="Y"||a>="Z"||a==="I"||a==="O")throw"MGRSPoint zone letter "+a+" not handled: "+t;n=t.substring(c,c+=2);for(var f=Z(i),s=x(n.charAt(0),f),v=O(n.charAt(1),f);v<X(a);)v+=2e6;var e=r-c;if(e%2!==0)throw`MGRSPoint has to have an even number 
of digits after the zone letter and two 100km letters - front 
half for easting meters, second half for 
northing meters`+t;var l=e/2,M=0,h=0,m,g,w,b,p;return l>0&&(m=1e5/Math.pow(10,l),g=t.substring(c,c+l),M=parseFloat(g)*m,w=t.substring(c+l),h=parseFloat(w)*m),b=M+s,p=h+v,{easting:b,northing:p,zoneLetter:a,zoneNumber:i,accuracy:m}}function x(t,r){for(var n=q.charCodeAt(r-1),u=1e5,o=!1;n!==t.charCodeAt(0);){if(n++,n===d&&n++,n===k&&n++,n>C){if(o)throw"Bad character: "+t;n=A,o=!0}u+=1e5}return u}function O(t,r){if(t>"V")throw"MGRSPoint given invalid Northing "+t;for(var n=y.charCodeAt(r-1),u=0,o=!1;n!==t.charCodeAt(0);){if(n++,n===d&&n++,n===k&&n++,n>z){if(o)throw"Bad character: "+t;n=A,o=!0}u+=1e5}return u}function X(t){var r;switch(t){case"C":r=11e5;break;case"D":r=2e6;break;case"E":r=28e5;break;case"F":r=37e5;break;case"G":r=46e5;break;case"H":r=55e5;break;case"J":r=64e5;break;case"K":r=73e5;break;case"L":r=82e5;break;case"M":r=91e5;break;case"N":r=0;break;case"P":r=8e5;break;case"Q":r=17e5;break;case"R":r=26e5;break;case"S":r=35e5;break;case"T":r=44e5;break;case"U":r=53e5;break;case"V":r=62e5;break;case"W":r=7e6;break;case"X":r=79e5;break;default:r=-1}if(r>=0)return r;throw"Invalid zone letter: "+t}export{E as default,J as forward,U as inverse,B as toPoint};
