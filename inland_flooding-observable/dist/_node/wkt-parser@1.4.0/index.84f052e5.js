var I=N,d=1,O=2,m=3,h=4,g=5,_=-1,R=/\s/,y=/[A-Za-z]/,D=/[A-Za-z84_]/,c=/[,\]]/,E=/[\d\.E\-\+]/;function o(t){if(typeof t!="string")throw new Error("not a string");this.text=t.trim(),this.level=0,this.place=0,this.root=null,this.stack=[],this.currentObject=null,this.state=d}o.prototype.readCharicter=function(){var t=this.text[this.place++];if(this.state!==h)for(;R.test(t);){if(this.place>=this.text.length)return;t=this.text[this.place++]}switch(this.state){case d:return this.neutral(t);case O:return this.keyword(t);case h:return this.quoted(t);case g:return this.afterquote(t);case m:return this.number(t);case _:return}},o.prototype.afterquote=function(t){if(t==='"'){this.word+='"',this.state=h;return}if(c.test(t)){this.word=this.word.trim(),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in afterquote yet, index '+this.place)},o.prototype.afterItem=function(t){if(t===","){this.word!==null&&this.currentObject.push(this.word),this.word=null,this.state=d;return}if(t==="]"){this.level--,this.word!==null&&(this.currentObject.push(this.word),this.word=null),this.state=d,this.currentObject=this.stack.pop(),this.currentObject||(this.state=_);return}},o.prototype.number=function(t){if(E.test(t)){this.word+=t;return}if(c.test(t)){this.word=parseFloat(this.word),this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in number yet, index '+this.place)},o.prototype.quoted=function(t){if(t==='"'){this.state=g;return}this.word+=t},o.prototype.keyword=function(t){if(D.test(t)){this.word+=t;return}if(t==="["){var e=[];e.push(this.word),this.level++,this.root===null?this.root=e:this.currentObject.push(e),this.stack.push(this.currentObject),this.currentObject=e,this.state=d;return}if(c.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in keyword yet, index '+this.place)},o.prototype.neutral=function(t){if(y.test(t)){this.word=t,this.state=O;return}if(t==='"'){this.word="",this.state=h;return}if(E.test(t)){this.word=t,this.state=m;return}if(c.test(t)){this.afterItem(t);return}throw new Error(`havn't handled "`+t+'" in neutral yet, index '+this.place)},o.prototype.output=function(){for(;this.place<this.text.length;)this.readCharicter();if(this.state===_)return this.root;throw new Error('unable to parse string "'+this.text+'". State is '+this.state)};function N(t){var e=new o(t);return e.output()}function C(t,e,r){Array.isArray(e)&&(r.unshift(e),e=null);var a=e?{}:t,l=r.reduce(function(n,i){return u(i,n),n},a);e&&(t[e]=l)}function u(t,e){if(!Array.isArray(t)){e[t]=!0;return}var r=t.shift();if(r==="PARAMETER"&&(r=t.shift()),t.length===1){if(Array.isArray(t[0])){e[r]={},u(t[0],e[r]);return}e[r]=t[0];return}if(!t.length){e[r]=!0;return}if(r==="TOWGS84"){e[r]=t;return}if(r==="AXIS"){r in e||(e[r]=[]),e[r].push(t);return}Array.isArray(r)||(e[r]={});var a;switch(r){case"UNIT":case"PRIMEM":case"VERT_DATUM":e[r]={name:t[0].toLowerCase(),convert:t[1]},t.length===3&&u(t[2],e[r]);return;case"SPHEROID":case"ELLIPSOID":e[r]={name:t[0],a:t[1],rf:t[2]},t.length===4&&u(t[3],e[r]);return;case"EDATUM":case"ENGINEERINGDATUM":case"LOCAL_DATUM":case"DATUM":case"VERT_CS":case"VERTCRS":case"VERTICALCRS":t[0]=["name",t[0]],C(e,r,t);return;case"COMPD_CS":case"COMPOUNDCRS":case"FITTED_CS":case"PROJECTEDCRS":case"PROJCRS":case"GEOGCS":case"GEOCCS":case"PROJCS":case"LOCAL_CS":case"GEODCRS":case"GEODETICCRS":case"GEODETICDATUM":case"ENGCRS":case"ENGINEERINGCRS":t[0]=["name",t[0]],C(e,r,t),e[r].type=r;return;default:for(a=-1;++a<t.length;)if(!Array.isArray(t[a]))return u(t,e[r]);return C(e,r,t)}}var v=.017453292519943295,G=["PROJECTEDCRS","PROJCRS","GEOGCS","GEOCCS","PROJCS","LOCAL_CS","GEODCRS","GEODETICCRS","GEODETICDATUM","ENGCRS","ENGINEERINGCRS"];function U(t,e){var r=e[0],a=e[1];!(r in t)&&a in t&&(t[r]=t[a],e.length===3&&(t[r]=e[2](t[r])))}function s(t){return t*v}function S(t){for(var e=Object.keys(t),r=0,a=e.length;r<a;++r){var l=e[r];G.indexOf(l)!==-1&&L(t[l]),typeof t[l]=="object"&&S(t[l])}}function L(t){if(t.AUTHORITY){var e=Object.keys(t.AUTHORITY)[0];e&&e in t.AUTHORITY&&(t.title=e+":"+t.AUTHORITY[e])}if(t.type==="GEOGCS"?t.projName="longlat":t.type==="LOCAL_CS"?(t.projName="identity",t.local=!0):typeof t.PROJECTION=="object"?t.projName=Object.keys(t.PROJECTION)[0]:t.projName=t.PROJECTION,t.AXIS){for(var r="",a=0,l=t.AXIS.length;a<l;++a){var n=[t.AXIS[a][0].toLowerCase(),t.AXIS[a][1].toLowerCase()];n[0].indexOf("north")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="north"?r+="n":n[0].indexOf("south")!==-1||(n[0]==="y"||n[0]==="lat")&&n[1]==="south"?r+="s":n[0].indexOf("east")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="east"?r+="e":(n[0].indexOf("west")!==-1||(n[0]==="x"||n[0]==="lon")&&n[1]==="west")&&(r+="w")}r.length===2&&(r+="u"),r.length===3&&(t.axis=r)}t.UNIT&&(t.units=t.UNIT.name.toLowerCase(),t.units==="metre"&&(t.units="meter"),t.UNIT.convert&&(t.type==="GEOGCS"?t.DATUM&&t.DATUM.SPHEROID&&(t.to_meter=t.UNIT.convert*t.DATUM.SPHEROID.a):t.to_meter=t.UNIT.convert));var i=t.GEOGCS;t.type==="GEOGCS"&&(i=t),i&&(i.DATUM?t.datumCode=i.DATUM.name.toLowerCase():t.datumCode=i.name.toLowerCase(),t.datumCode.slice(0,2)==="d_"&&(t.datumCode=t.datumCode.slice(2)),t.datumCode==="new_zealand_1949"&&(t.datumCode="nzgd49"),(t.datumCode==="wgs_1984"||t.datumCode==="world_geodetic_system_1984")&&(t.PROJECTION==="Mercator_Auxiliary_Sphere"&&(t.sphere=!0),t.datumCode="wgs84"),t.datumCode==="belge_1972"&&(t.datumCode="rnb72"),i.DATUM&&i.DATUM.SPHEROID&&(t.ellps=i.DATUM.SPHEROID.name.replace("_19","").replace(/[Cc]larke\_18/,"clrk"),t.ellps.toLowerCase().slice(0,13)==="international"&&(t.ellps="intl"),t.a=i.DATUM.SPHEROID.a,t.rf=parseFloat(i.DATUM.SPHEROID.rf,10)),i.DATUM&&i.DATUM.TOWGS84&&(t.datum_params=i.DATUM.TOWGS84),~t.datumCode.indexOf("osgb_1936")&&(t.datumCode="osgb36"),~t.datumCode.indexOf("osni_1952")&&(t.datumCode="osni52"),(~t.datumCode.indexOf("tm65")||~t.datumCode.indexOf("geodetic_datum_of_1965"))&&(t.datumCode="ire65"),t.datumCode==="ch1903+"&&(t.datumCode="ch1903"),~t.datumCode.indexOf("israel")&&(t.datumCode="isr93")),t.b&&!isFinite(t.b)&&(t.b=t.a);function p(f){var w=t.to_meter||1;return f*w}var A=function(f){return U(t,f)},T=[["standard_parallel_1","Standard_Parallel_1"],["standard_parallel_1","Latitude of 1st standard parallel"],["standard_parallel_2","Standard_Parallel_2"],["standard_parallel_2","Latitude of 2nd standard parallel"],["false_easting","False_Easting"],["false_easting","False easting"],["false-easting","Easting at false origin"],["false_northing","False_Northing"],["false_northing","False northing"],["false_northing","Northing at false origin"],["central_meridian","Central_Meridian"],["central_meridian","Longitude of natural origin"],["central_meridian","Longitude of false origin"],["latitude_of_origin","Latitude_Of_Origin"],["latitude_of_origin","Central_Parallel"],["latitude_of_origin","Latitude of natural origin"],["latitude_of_origin","Latitude of false origin"],["scale_factor","Scale_Factor"],["k0","scale_factor"],["latitude_of_center","Latitude_Of_Center"],["latitude_of_center","Latitude_of_center"],["lat0","latitude_of_center",s],["longitude_of_center","Longitude_Of_Center"],["longitude_of_center","Longitude_of_center"],["longc","longitude_of_center",s],["x0","false_easting",p],["y0","false_northing",p],["long0","central_meridian",s],["lat0","latitude_of_origin",s],["lat0","standard_parallel_1",s],["lat1","standard_parallel_1",s],["lat2","standard_parallel_2",s],["azimuth","Azimuth"],["alpha","azimuth",s],["srsCode","name"]];T.forEach(A),!t.long0&&t.longc&&(t.projName==="Albers_Conic_Equal_Area"||t.projName==="Lambert_Azimuthal_Equal_Area")&&(t.long0=t.longc),!t.lat_ts&&t.lat1&&(t.projName==="Stereographic_South_Pole"||t.projName==="Polar Stereographic (variant B)")?(t.lat0=s(t.lat1>0?90:-90),t.lat_ts=t.lat1):!t.lat_ts&&t.lat0&&t.projName==="Polar_Stereographic"&&(t.lat_ts=t.lat0,t.lat0=s(t.lat0>0?90:-90))}function P(t){var e=I(t),r=e[0],a={};return u(e,a),S(a),a[r]}export{P as default};
